<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="generator" content="hevea 2.35">
<style type="text/css">
.c000{font-style:italic}
.c001{font-style:italic;font-weight:bold}
.c002{font-weight:bold}
.li-itemize{margin:1ex 0ex;}
.li-enumerate{margin:1ex 0ex;}
.toc{list-style:none;}
div.footnotetext P{margin:0px; text-indent:1em;}
.center{text-align:center;margin-left:auto;margin-right:auto;}
div table{margin-left:inherit;margin-right:inherit;margin-bottom:2px;margin-top:2px}
td table{margin:auto;}
table{border-collapse:collapse;}
td{padding:0;}
pre{text-align:left;margin-left:0ex;margin-right:auto;}
blockquote{margin-left:4ex;margin-right:4ex;text-align:left;}
td p{margin:0px;}
.quote{margin-left:3em;margin-right:3em;text-align:inherit;text-indent:0pt}
.horizontal-rule{border:none;background-color:black;}
.lstlisting{font-family:monospace;white-space:pre;margin-right:auto;margin-left:0pt;text-align:left}
body { background-image: url('/documents/src/images/bg.png'); 	 } 
html { cursor: url('/stuff/cursor.gif'), auto; height: 100% } 
</style>
<title>How to make a Linux Distro (WIP)
</title>
</head>
<body>
<!--HEVEA command line is: hevea HTMLD.tex -O -o ../HTMLD/index.html -->
<!--CUT STYLE article--><!--CUT DEF section 1 --><p>
	</p><div class="center">
		<span style="font-weight:bold;font-size:xx-large">		How to make a Linux Distro (WIP)</span>
		<p>		Funy Monkey &#X2014; Last Updated: 2021 06 07 
	</p></div><!--TOC section id="sec1" Table of Contents-->
<h2 class="section" id="sec1">Table of Contents</h2><!--SEC END --><ul class="toc"><li class="li-toc">
<a href="#sec2">1&#X2003;Foreword</a>
</li><li class="li-toc"><a href="#sec3">2&#X2003;From Scratch</a>
<ul class="toc"><li class="li-toc">
<a href="#sec4">2.1&#X2003;The Base</a>
<ul class="toc"><li class="li-toc">
<a href="#sec5">2.1.1&#X2003;Workspace</a>
</li><li class="li-toc"><a href="#sec6">2.1.2&#X2003;Kernel</a>
</li><li class="li-toc"><a href="#sec7">2.1.3&#X2003;Root Filesystem</a>
</li><li class="li-toc"><a href="#sec8">2.1.4&#X2003;Booting</a>
</li></ul>
</li><li class="li-toc"><a href="#sec9">2.2&#X2003;Adding Programs</a>
<ul class="toc"><li class="li-toc">
<a href="#sec10">2.2.1&#X2003;Bash</a>
<ul class="toc"><li class="li-toc">
<a href="#sec11">2.2.1.1&#X2003;Dynamic Linking</a>
</li><li class="li-toc"><a href="#sec12">2.2.1.2&#X2003;Static Linking</a>
</li></ul>
</li><li class="li-toc"><a href="#sec13">2.2.2&#X2003;BusyBox</a>
<ul class="toc"><li class="li-toc">
<a href="#sec14">2.2.2.1&#X2003;Dynamic Linking</a>
</li><li class="li-toc"><a href="#sec15">2.2.2.2&#X2003;Static Linking</a>
</li></ul>
</li><li class="li-toc"><a href="#sec16">2.2.3&#X2003;Package Manager</a>
<ul class="toc"><li class="li-toc">
<a href="#sec17">2.2.3.1&#X2003;The Packages</a>
</li><li class="li-toc"><a href="#sec18">2.2.3.2&#X2003;The Manager</a>
</li></ul>
</li><li class="li-toc"><a href="#sec19">2.2.4&#X2003;Boot Loader</a>
<ul class="toc"><li class="li-toc">
<a href="#sec20">2.2.4.1&#X2003;ISO</a>
</li><li class="li-toc"><a href="#sec21">2.2.4.2&#X2003;Installed System</a>
</li></ul>
</li></ul>
</li><li class="li-toc"><a href="#sec22">2.3&#X2003;Making an Installer</a>
</li></ul>
</li><li class="li-toc"><a href="#sec23">3&#X2003;Arch Based</a>
<ul class="toc"><li class="li-toc">
<a href="#sec24">3.1&#X2003;Archiso</a>
<ul class="toc"><li class="li-toc">
<a href="#sec25">3.1.1&#X2003;Workspace</a>
</li><li class="li-toc"><a href="#sec26">3.1.2&#X2003;Adding Packages</a>
</li><li class="li-toc"><a href="#sec27">3.1.3&#X2003;Configuring the Root Filesystem</a>
</li><li class="li-toc"><a href="#sec28">3.1.4&#X2003;Kernel</a>
</li></ul>
</li><li class="li-toc"><a href="#sec29">3.2&#X2003;ISO Editing</a>
</li><li class="li-toc"><a href="#sec30">3.3&#X2003;Making an Installer</a>
</li><li class="li-toc"><a href="#sec31">3.4&#X2003;Booting</a>
<ul class="toc"><li class="li-toc">
<a href="#sec32">3.4.1&#X2003;Hardware</a>
</li><li class="li-toc"><a href="#sec33">3.4.2&#X2003;Virtual Machine</a>
</li></ul>
</li></ul>
</li><li class="li-toc"><a href="#sec34">4&#X2003;Debian Based</a>
</li><li class="li-toc"><a href="#sec35">5&#X2003;Ubuntu Based</a>
</li><li class="li-toc"><a href="#sec36">6&#X2003;Generic</a>
</li><li class="li-toc"><a href="#sec37">7&#X2003;Branding</a>
</li><li class="li-toc"><a href="#sec38">8&#X2003;Afterword</a>
</li><li class="li-toc"><a href="#sec39">9&#X2003;Sources</a>
</li></ul>
<!--TOC section id="sec2" Foreword-->
<h2 class="section" id="sec2">1&#X2003;Foreword</h2><!--SEC END --><p>
	<span class="c001">Why would you want to make your own Linux Distro?</span></p><p>	When needing to deploy multiple Systems it can sometimes be easier to just run the installer of your own Linux Distro and be done with it, instead of having to either do it Manually or use a Script. It can also be very fun!
	<br>
And it can help you learn the inner workings of a Linux Distro.</p><p>	<span class="c001">i gotta add more shit here!</span></p><p>	It is Reccomended to make a Shell Script instead of running commands Manually to more easily Modify the System
	<br>
	It can be very helpful to use a tool like <a href="https://git-scm.com">git</a> to easily revert changes</p>
<!--TOC section id="sec3" From Scratch-->
<h2 class="section" id="sec3">2&#X2003;From Scratch</h2><!--SEC END --><p>
<a id="Scratch"></a>
<span class="c002">NOT RECOMMENDED!</span>
</p>
<!--TOC subsection id="sec4" The Base-->
<h3 class="subsection" id="sec4">2.1&#X2003;The Base</h3><!--SEC END --><p>
	<a id="ScratchBase"></a>
	Depending on how minimal you want your Distro to be, it is <span class="c002">Very reccommended</span> that you follow the <a href="https://linuxfromscratch.org/lfs">Linux from Scratch Book</a></p><p>	The <a href="https://linuxfromscratch.org/lfs">Linux from Scratch Book</a> is already <span class="c002">Very, Very</span> Minimal, so we will be going through the <span class="c002">ABSOLUTE MINIMUM</span> for a <span class="c000">working</span> Linux System 
		</p>
<!--TOC subsubsection id="sec5" Workspace-->
<h4 class="subsubsection" id="sec5">2.1.1&#X2003;Workspace</h4><!--SEC END --><p>
			Create a Folder for the Workspace and make all needed Folders
			
			</p><div class="lstlisting">        mkdir -v &lt;WorkspaceDirectory&gt;
        cd &lt;WorkspaceDirectory&gt;
        mkdir -v rootfs</div><p>		</p>
<!--TOC subsubsection id="sec6" Kernel-->
<h4 class="subsubsection" id="sec6">2.1.2&#X2003;Kernel</h4><!--SEC END --><p>			Download and Extract the Linux Kernel (There probably will be newer kernels than the one on the link shown here. If you want a newer Linux Kernel go to <a href="https://www.kernel.org">The linux kernel Website</a> and download it from there.)
			</p><div class="lstlisting">        wget https://cdn.kernel.org/pub/linux/kernel/v5.x/linux-5.12.8.tar.xz
        tar -xvf linux-5.12.8.tar.xz
        cd linux-5.12.8</div><p>			Now we need to <span class="c002">Compile and Configure</span> the Kernel, depending on what this must run on this can be either very Simple or Complex and Time Consuming.
			</p><div class="lstlisting">        make mrproper
        make defconfig
        make menuconfig</div><p>			For documentation on comfiguring the Linux Kernel, check out <a href="https://linuxfromscratch.org/lfs/view/stable/chapter10/kernel.html">This</a> Segment of the Linux From Scratch Book and the <a href="https://wiki.gentoo.org/wiki/Kernel/Configuration">Gentoo wiki Page</a> on Configuring the Kernel
			</p><div class="lstlisting">        make -j&lt;threads to be used&gt; # use the command "nproc --all" to find out how many Threads are on your System
        cp -iv arch/x86/boot/bzImage ../vmlinuz
        cd ..</div><p>			Replace &#X201C;x86&#X201D; with another Architecture if you are not compiling the x86 Linux Kernel
		</p>
<!--TOC subsubsection id="sec7" Root Filesystem-->
<h4 class="subsubsection" id="sec7">2.1.3&#X2003;Root Filesystem</h4><!--SEC END --><p>
			The first File we need is the init which will initialize the System, it needs to be an Executable program.
			</p><div class="lstlisting">        # Edit init.c with your favorite Text Editor #

        #include &lt;stdio.h&gt;
        #include &lt;unistd.d&gt;

        int main() {
                printf("Hello, Linux World!\n");
                sleep(0xFFFFFFFF);
                return 0;
        }

        # Edit init.c with your favorite Text Editor #
        gcc -static init.c -o rootfs/init</div><p>			</p>
<!--TOC subsubsection id="sec8" Booting-->
<h4 class="subsubsection" id="sec8">2.1.4&#X2003;Booting</h4><!--SEC END --><p>
			</p><div class="lstlisting">        (cd rootfs &amp;&amp; find . | cpio -o -H newc | gzip &gt; ../rootfs.cpio.gz)
        qemu-system-x86_64 &lt;other qemu parameters (for example: -m 128M)&gt; -kernel vmlinuz -initrd rootfs.cpio.gz</div><p>			When booted, it should print out &#X201C;Hello, Linux World!&#X201D; as shown here.
			<br>
			<img src="/documents/src/images/hellolinuxworld.png">
		
		</p>
<!--TOC subsection id="sec9" Adding Programs-->
<h3 class="subsection" id="sec9">2.2&#X2003;Adding Programs</h3><!--SEC END --><p>
		Now we have a <span class="c000">working</span> Linux System, albeit very useless.
		<br>
		So lets add Some Programs.
		</p>
<!--TOC subsubsection id="sec10" Bash-->
<h4 class="subsubsection" id="sec10">2.2.1&#X2003;Bash</h4><!--SEC END --><p>
		</p>
<!--TOC paragraph id="sec11" Dynamic Linking-->
<h4 class="paragraph" id="sec11">2.2.1.1&#X2003;Dynamic Linking</h4><!--SEC END --><p>
		<a id="BashDynamic"></a>
		To dynamically compile Bash, the Linux System will need all of Bash&#X2019;s Dependencies, which are
		</p><ol class="enumerate" type=1><li class="li-enumerate">
			glibc
			</li><li class="li-enumerate">ncurses
			</li><li class="li-enumerate">readline
		</li></ol><p>
		And you will of course need the Dependencies of those Programs as well.
		<br>
		You could also follow the <a href="https://linuxfromscratch.org/lfs/view/stable/chapter05/binutils-pass1.html">Linux from Scratch Book Compilation Segment</a> up until Bash.</p><p>		Now, to Download and Compile Bash:
		<br>
		Remember that there might be a newer Version of Bash on the <a href="https://www.gnu.org/software/bash">Bash Website</a>
		</p><div class="lstlisting">        wget https://ftp.gnu.org/gnu/bash/bash-5.1.tar.gz
        tar -xf bash-5.1.tar.gz
        cd bash-5.1
        ./configure --prefix=/usr                   \
                    --build=$(support/config.guess) \
                    --host=x86_64                   \
                    --without-bash-malloc
        make
        make DESTDIR=&lt;WorkspaceDirectory&gt;/rootfs install
        cd ..</div><p>		Replace &#X201C;x86_64&#X201D; with another Architecture if you are not compiling for x86_64</p><p>		Bash will now reside in /usr/bin/bash, but it should be moved to /bin/bash
		</p><div class="lstlisting">        cd rootfs
        mkdir -v bin
        mv usr/bin/bash bin/bash</div><p>		</p>
<!--TOC paragraph id="sec12" Static Linking-->
<h4 class="paragraph" id="sec12">2.2.1.2&#X2003;Static Linking</h4><!--SEC END --><p>
		<a id="BashStatic"></a>
		Static Compilation does not need any of Bash&#X2019;s dependencies to be in the System, instead it is just one Singular File.</p><p>		<a href="https://www.musl-libc.org">musl</a> is needed for true Static linking
		<br>
Either install it with a Package Manager of choice or build it from Source.</p><p>		Set &#X201C;musl-gcc&#X201D; as the C Compiler and set CFLAGS.
		</p><div class="lstlisting">        export CC="musl-gcc"
        export CFLAGS="-static"</div><p>		Now, to Download and Compile Bash:
		<br>
		Remember that there might be a newer Version of Bash on the <a href="https://www.gnu.org/software/bash">Bash Website</a>
		</p><div class="lstlisting">        wget https://ftp.gnu.org/gnu/bash/bash-5.1.tar.gz
        tar -xf bash-5.1.tar.gz
        cd bash-5.1
        CFLAGS="$CFLAGS -Os" ./configure --prefix=/usr                   \
                                         --build=$(support/config.guess) \
                                         --host=x86_64                   \
                                         --without-bash-malloc
        make
        make DESTDIR=&lt;WorkspaceDirectory&gt;/rootfs install
        cd ..</div><p>		Replace &#X201C;x86_64&#X201D; with another Architecture if you are not compiling for x86_64</p><p>		Bash will now reside in /usr/bin/bash, but it should be moved to /bin/bash
		</p><div class="lstlisting">        cd rootfs
        mkdir -v bin
        mv usr/bin/bash bin/bash</div><p>		</p>
<!--TOC subsubsection id="sec13" BusyBox-->
<h4 class="subsubsection" id="sec13">2.2.2&#X2003;BusyBox</h4><!--SEC END --><p>
			</p>
<!--TOC paragraph id="sec14" Dynamic Linking-->
<h4 class="paragraph" id="sec14">2.2.2.1&#X2003;Dynamic Linking</h4><!--SEC END --><p>
			</p>
<!--TOC paragraph id="sec15" Static Linking-->
<h4 class="paragraph" id="sec15">2.2.2.2&#X2003;Static Linking</h4><!--SEC END --><p>	
		</p>
<!--TOC subsubsection id="sec16" Package Manager-->
<h4 class="subsubsection" id="sec16">2.2.3&#X2003;Package Manager</h4><!--SEC END --><p>	
			</p>
<!--TOC paragraph id="sec17" The Packages-->
<h4 class="paragraph" id="sec17">2.2.3.1&#X2003;The Packages</h4><!--SEC END --><p>
			</p>
<!--TOC paragraph id="sec18" The Manager-->
<h4 class="paragraph" id="sec18">2.2.3.2&#X2003;The Manager</h4><!--SEC END --><p>
		</p>
<!--TOC subsubsection id="sec19" Boot Loader-->
<h4 class="subsubsection" id="sec19">2.2.4&#X2003;Boot Loader</h4><!--SEC END --><p>
			</p>
<!--TOC paragraph id="sec20" ISO-->
<h4 class="paragraph" id="sec20">2.2.4.1&#X2003;ISO</h4><!--SEC END --><p>
			</p>
<!--TOC paragraph id="sec21" Installed System-->
<h4 class="paragraph" id="sec21">2.2.4.2&#X2003;Installed System</h4><!--SEC END --><p>
		</p>
<!--TOC subsection id="sec22" Making an Installer-->
<h3 class="subsection" id="sec22">2.3&#X2003;Making an Installer</h3><!--SEC END -->
<!--TOC section id="sec23" Arch Based-->
<h2 class="section" id="sec23">3&#X2003;Arch Based</h2><!--SEC END -->
<!--TOC subsection id="sec24" Archiso-->
<h3 class="subsection" id="sec24">3.1&#X2003;Archiso</h3><!--SEC END --><p>
	<a id="Archiso"></a>
	<span class="c002">YOU NEED TO BE ON AN ARCH LINUX SYSTEM!</span>	
</p>
<!--TOC subsubsection id="sec25" Workspace-->
<h4 class="subsubsection" id="sec25">3.1.1&#X2003;Workspace</h4><!--SEC END --><p>
	First install Archiso:
	</p><div class="lstlisting">        sudo pacman -S archiso</div><p>	Archiso comes with 2 profiles, <span class="c002">releng</span> and <span class="c002">baseline</span>.
	</p><ul class="itemize"><li class="li-itemize">
		<span class="c002">releng</span> is used to create the official monthly installation ISO. It can be used as a starting point for creating a customized ISO image.
	</li><li class="li-itemize"><span class="c002">baseline</span> is a minimalistic configuration, that includes only the bare minimum packages required to boot the live environment from the medium.
	</li></ul><p>
	Copy the Profile of your Choice to a Directory of your Choice:
	</p><div class="lstlisting">        cp -r /usr/share/archiso/configs/&lt;profile&gt; &lt;directory&gt;</div>
<!--TOC subsubsection id="sec26" Adding Packages-->
<h4 class="subsubsection" id="sec26">3.1.2&#X2003;Adding Packages</h4><!--SEC END --><p>
<span class="c002">If your Distro will Include Xorg/Wayland you should add the Drivers to the Hardware that will be used</span>
</p>
<!--TOC subsubsection id="sec27" Configuring the Root Filesystem-->
<h4 class="subsubsection" id="sec27">3.1.3&#X2003;Configuring the Root Filesystem</h4><!--SEC END -->
<!--TOC subsubsection id="sec28" Kernel-->
<h4 class="subsubsection" id="sec28">3.1.4&#X2003;Kernel</h4><!--SEC END -->
<!--TOC subsection id="sec29" ISO Editing-->
<h3 class="subsection" id="sec29">3.2&#X2003;ISO Editing</h3><!--SEC END -->
<!--TOC subsection id="sec30" Making an Installer-->
<h3 class="subsection" id="sec30">3.3&#X2003;Making an Installer</h3><!--SEC END -->
<!--TOC subsection id="sec31" Booting-->
<h3 class="subsection" id="sec31">3.4&#X2003;Booting</h3><!--SEC END -->
<!--TOC subsubsection id="sec32" Hardware-->
<h4 class="subsubsection" id="sec32">3.4.1&#X2003;Hardware</h4><!--SEC END -->
<!--TOC subsubsection id="sec33" Virtual Machine-->
<h4 class="subsubsection" id="sec33">3.4.2&#X2003;Virtual Machine</h4><!--SEC END --><p>
<span class="c002">For a more in-depth guide of QEMU check out the </span><a href="/documents/QEMU"><span class="c002">Document on QEMU</span></a>
</p>
<!--TOC section id="sec34" Debian Based-->
<h2 class="section" id="sec34">4&#X2003;Debian Based</h2><!--SEC END -->
<!--TOC section id="sec35" Ubuntu Based-->
<h2 class="section" id="sec35">5&#X2003;Ubuntu Based</h2><!--SEC END -->
<!--TOC section id="sec36" Generic-->
<h2 class="section" id="sec36">6&#X2003;Generic</h2><!--SEC END -->
<!--TOC section id="sec37" Branding-->
<h2 class="section" id="sec37">7&#X2003;Branding</h2><!--SEC END -->
<!--TOC section id="sec38" Afterword-->
<h2 class="section" id="sec38">8&#X2003;Afterword</h2><!--SEC END -->
<!--TOC section id="sec39" Sources-->
<h2 class="section" id="sec39">9&#X2003;Sources</h2><!--SEC END --><p>
<a href="#Scratch">2</a> <a href="https://www.linuxfromscratch.org/lfs">Linux From Scratch Book</a></p><p><a href="#ScratchBase">2.1</a> <a href="https://stackoverflow.com/a/30056182">Stackoverflow Answer</a> </p><p><a href="#BashDynamic">2.2.1.1</a> <a href="https://linuxfromscratch.org/lfs/view/stable/chapter06/bash.html">Linux From Scratch Bash Page</a></p><p><a href="#BashStatic">2.2.1.2</a> <a href="https://github.com/robxu9/bash-static/blob/master/build.sh">Static Bash Build Script</a></p><p><a href="#Archiso">3.1</a> <a href="https://wiki.archlinux.org/title/archiso">Archiso Arch Wiki Page</a>
</p><!--CUT END -->
<!--HTMLFOOT-->
<!--ENDHTML-->
<!--FOOTER-->
<hr class="horizontal-rule" style="height:2px"><blockquote class="quote"><em>This document was translated from L<sup>A</sup>T<sub>E</sub>X by
</em><a href="http://hevea.inria.fr/index.html"><em>H<span style="font-size:small"><sup>E</sup></span>V<span style="font-size:small"><sup>E</sup></span>A</em></a><em>.</em></blockquote></body>
</html>
